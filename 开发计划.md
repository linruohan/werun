# WeRun 启动器开发文档

## 项目概述

使用 **Rust + GPUI + gpui-component** 开发的高性能 Windows 启动器，灵感来源于 Vicinae，具有现代化的 UI 和流畅的动画效果。

---

## 技术栈

- **框架**: GPUI (Zed 编辑器团队开发的 GPU 加速 UI 框架)
- **组件库**: gpui-component (丰富的 UI 组件库)
- **语言**: Rust
- **平台**: Windows 10/11

---

## 功能清单

### 已完成功能

#### 核心功能
- ✅ 应用启动 (app_launcher) - 扫描开始菜单，快速启动应用
- ✅ 文件搜索 (file_search) - 快速搜索文件和文件夹
- ✅ 计算器 (calculator) - 数学表达式计算
- ✅ 剪贴板历史 (clipboard) - 剪贴板监听和历史记录
- ✅ 网页搜索 (web_search) - 快速使用搜索引擎搜索
- ✅ 系统命令 (system_commands) - 常用系统操作
- ✅ 自定义命令 (custom_commands) - 用户自定义命令脚本
- ✅ 颜色选择器 (color_picker) - 颜色识别和转换
- ✅ 窗口切换器 (window_switcher) - 切换活跃窗口

#### UI/交互
- ✅ 无边框浮动窗口
- ✅ 窗口居中显示
- ✅ 圆角和阴影效果
- ✅ 键盘导航 (↑↓ 选择，Enter 确认，Esc 关闭)
- ✅ List 组件内置搜索
- ✅ 主题支持 (Light/Dark)
- ✅ 结果项高亮显示
- ✅ 结果类型图标显示

#### 系统集成
- ✅ 全局快捷键 (Alt+Space)
- ✅ 失焦自动隐藏
- ✅ 插件系统架构

---

## 使用说明

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| `Alt + Space` | 显示/隐藏启动器 |
| `↑ / ↓` | 选择搜索结果 |
| `Enter` | 执行选中的项目 |
| `Esc` | 关闭启动器 |

### 搜索语法

#### 应用启动
直接输入应用名称进行搜索。

#### 文件搜索
输入文件路径或文件名进行搜索。

#### 计算器
输入数学表达式，如 `123+456` 或 `sqrt(16)`。

#### 颜色选择器
输入颜色值，如 `#FF5500`、`rgb(255,85,0)` 或 `hsl(30,100%,50%)`。

#### 网页搜索
输入搜索内容，选择搜索引擎进行搜索。

#### 系统命令
输入系统命令关键字，如"关机"、"重启"、"锁屏"等。

---

## 项目结构

```
werun/
├── Cargo.toml                 # 项目配置
├── src/
│   ├── main.rs               # 入口点
│   ├── lib.rs                # 库导出
│   ├── app.rs                # 应用主逻辑
│   ├── window_manager.rs     # 窗口管理
│   ├── core/                 # 核心模块
│   │   ├── search.rs         # 搜索引擎
│   │   ├── plugin.rs         # 插件系统
│   │   ├── config.rs         # 配置结构
│   │   └── config_manager.rs # 配置管理
│   ├── ui/                   # UI 组件
│   │   ├── launcher_window.rs   # 主窗口
│   │   ├── search_bar.rs        # 搜索栏
│   │   ├── result_list.rs       # 结果列表
│   │   ├── result_item.rs       # 结果项
│   │   ├── preview_panel.rs     # 预览面板
│   │   └── themes.rs            # 主题管理
│   ├── plugins/              # 内置插件
│   │   ├── app_launcher.rs   # 应用启动
│   │   ├── file_search.rs    # 文件搜索
│   │   ├── calculator.rs     # 计算器
│   │   ├── clipboard.rs      # 剪贴板历史
│   │   ├── web_search.rs     # 网页搜索
│   │   ├── system_commands.rs # 系统命令
│   │   ├── custom_commands.rs # 自定义命令
│   │   ├── color_picker.rs   # 颜色选择器
│   │   └── window_switcher.rs # 窗口切换
│   ├── platform/             # 平台相关
│   │   └── windows.rs        # Windows API
│   └── utils/
│       ├── clipboard.rs      # 剪贴板工具
│       └── fuzzy.rs          # 模糊搜索
└── themes/                   # 主题文件
```

---

## 插件开发

### 创建新插件

1. 在 `src/plugins/` 目录下创建新的插件文件
2. 实现 `Plugin` trait

```rust
use crate::core::plugin::{Plugin, SearchResult};

pub struct MyPlugin {
    // 插件状态
}

impl MyPlugin {
    pub fn new() -> Self {
        Self { /* 初始化 */ }
    }
}

impl Plugin for MyPlugin {
    fn id(&self) -> &str {
        "my_plugin"
    }

    fn name(&self) -> &str {
        "我的插件"
    }

    fn search(&self, query: &str, limit: usize) -> Result<Vec<SearchResult>> {
        // 搜索逻辑
        Ok(vec![])
    }

    fn execute(&self, result: &SearchResult) -> Result<()> {
        // 执行逻辑
        Ok(())
    }
}
```

2. 在 `src/plugins/mod.rs` 中添加模块
3. 在 `launcher_window.rs` 中注册插件

---

## 配置说明

### 快捷键配置

在配置文件中修改快捷键绑定：

```json
{
    "keybindings": {
        "navigate_up": "ArrowUp",
        "navigate_down": "ArrowDown",
        "confirm": "Enter",
        "close": "Escape"
    }
}
```

### 主题配置

支持 Light 和 Dark 主题，通过 `themes` 操作切换。

---

## 常见问题

### Q: 全局快捷键注册失败
A: 确保没有其他程序占用 `Alt + Space` 快捷键。

### Q: 搜索结果不准确
A: 检查对应的插件是否正确加载，可以查看日志输出。

### Q: 启动速度慢
A: 首次启动会建立索引，后续使用会更快。

---

## 开发计划

### 待完成功能

- [ ] 预览面板集成 - 选中项目时显示详细信息
- [ ] 文件预览支持 - 预览文件内容
- [ ] 索引缓存优化 - 加速搜索
- [ ] 性能优化 - 减少内存占用
- [ ] 单元测试 - 核心功能测试

---

*文档更新时间: 2026-02-17*
